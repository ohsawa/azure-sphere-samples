name: setup-sdk

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  cmake_dir: build

jobs:
  build:
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: download
      run: |
        wget https://aka.ms/AzureSphereSDKInstall/Linux -O install.sh
        chmod +x install.sh
        sudo apt-get install -y net-tools curl ninja-build
        yes Y | sudo ./install.sh
    - name: build
      
      run: |
        cd Samples/AzureIoT
        mkdir $CMAKE_DIR
        cd $CMAKE_DIR
        pwd
        echo hoge ${CMAKE_DIR}
        cmake -G "Ninja" -DCMAKE_TOOLCHAIN_FILE="/opt/azurespheresdk/CMakeFiles/AzureSphereToolchain.cmake" -DAZURE_SPHERE_TARGET_API_SET="4" -DAZURE_SPHERE_TARGET_HARDWARE_DEFINITION_DIRECTORY="${GITHUB_WORKSPACE}/Hardware/mt3620_rdb" -DAZURE_SPHERE_TARGET_HARDWARE_DEFINITION="sample_hardware.json" --no-warn-unused-cli -DCMAKE_BUILD_TYPE="Debug" -DCMAKE_MAKE_PROGRAM="ninja" ..
      env:
        CMAKE_DIR: build 
            
